<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript">

			function ready() {
				if (!!window.EventSource) {
					setupEventSource();
				} else {
					document.getElementById('status').innerHTML =
						"Sorry but your browser doesn't support the EventSource API";
				}
			}
					function setupEventSource() {
			var source = new EventSource('/eventsource');

					source.addEventListener('message', function(event) {
					//addStatus("server sent the following: '" + event.data + "'");
					addStatus(event.data);
						Y = event.data;
						//console.log(Y);
					
					}, false);

					source.addEventListener('open', function(event) {
						//addStatus('eventsource connected.')
					}, false);

					source.addEventListener('error', function(event) {
							//window.stop();
						console.log(Y);
							location.replace("http://mail-testing.com/results/" + Y);

						if (event.eventPhase == EventSource.CLOSED) {
							addStatus('eventsource was clozed.')
						}
					}, false);
			}

			function addStatus(text) {
				document.getElementById('status').innerHTML
				= document.getElementById('status').innerHTML
				+  text + "<br/>";
			}
		</script>
	</head>
	<!-- <body onload="ready();">   -->
	<body>
		<button onclick="ready()">Start</button> Press the "Start" to begin.
		<button onclick="stop()">Stop</button> "Stop" to finish.
		Hi! Pour tester votre email, vous devez envoyer un message a l'adresse ci-dessous:
		<div id="status"></div>
	</body>
</html>
